<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Confirmed | ChapterOne</title>
  <link rel="stylesheet" href="/tag/public/assets/css/style.css">

</head>

<body>
  <header class="header">
    <div class="container">
      <h1 class="logo">ChapterOne</h1>
    </div>
  </header>

  <main class="main">
    <div class="confirmation-container">
      <h2>Thank You for Your Order! ðŸ“š</h2>
      <p>Your order has been confirmed and will be shipped soon.</p>

      <div class="order-summary">
        <h3>Order #BK2024-1001</h3>
        <p><strong>Date:</strong> <span id="order-date">June 15, 2024</span></p>
        <p><strong>Total:</strong> <span id="order-total">$59.99</span></p>
        <ul id="order-items">
          <li>1 Ã— The Great Gatsby - $19.99</li>
          <li>1 Ã— Atomic Habits - $24.99</li>
          <li>1 Ã— Shipping - $5.00</li>
        </ul>
      </div>

      <a href="/tag/public/index.html" class="btn btn-primary">Back to Home</a>
    </div>
  </main>

  <script src="/tag/public/assets/js/script.js"></script>
  <script>
    // Load Axios if not already loaded
    if (typeof axios === 'undefined') {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js';
      document.head.appendChild(script);
    }

    // Track purchase function
    const trackPurchase = async () => {
      const order = {
        id: "BK12345",
        total: 49.99,
        items: [
          { id: "1001", name: "Atomic Habits", price: 24.99 },
          { id: "1002", name: "Deep Work", price: 19.99 }
        ]
      };

      // Data Layer for GTM
      window.dataLayer = window.dataLayer || [];
      dataLayer.push({
        event: "purchase",
        ecommerce: {
          transaction_id: order.id,
          value: order.total,
          items: order.items
        }
      });

      // API Call with CORS headers
      try {
        const response = await axios.post(
          'https://trackingservice-401966967468.us-east1.run.app',
          order,
          {
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            }
          }
        );
        console.log('API Response:', response.data);
      } catch (error) {
        console.error('Tracking failed:', error);
      }
    };

    // Wait for Axios to load if needed
    if (typeof axios !== 'undefined') {
      trackPurchase();
    } else {
      document.addEventListener('axiosReady', trackPurchase);
    }
  </script>
  </script>
</body>

</html>